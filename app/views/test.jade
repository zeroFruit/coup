html
  head
    meta(charset="utf-8")
    meta(http-equiv="X-UA-Compatible" content="IE=edge")
    meta(name="viewport" content="width=device-width initial-scale=1")
    //- BOOTSTRAP STYLES
    link(href='public/stylesheets/temp/bootstrap.css',      rel='stylesheet')
    //- FONTAWESOME STYLES
    link(href='public/stylesheets/temp/font-awesome.css',   rel='stylesheet')
    //- TEMPLATE BASIC STYLES
    link(href='public/stylesheets/temp/basic.css',          rel='stylesheet')
    //- TEMPLATE MAIN STYLES
    link(href='public/stylesheets/temp/custom.css',         rel='stylesheet')
    //- TEMPLATE FORM SCRIPTS
    script(src='public/javascripts/temp/switchery.min.js')
    //- TEMPLATE FORM STYLEs
    link(href='public/stylesheets/temp/form-style.css',     rel='stylesheet')
    link(href='public/stylesheets/temp/switchery.min.css',  rel='stylesheet')
    link(href='public/stylesheets/temp/modal-form.css',     rel='stylesheet')
    //- GOOGLE FONTS
    link(href='http://fonts.googleapis.com/css?family=Open+Sans', rel='stylesheet', type='text/css')
    link(href='http://fonts.googleapis.com/earlyaccess/jejugothic.css', rel='stylesheet', type='text/css')
    //- TEMPLATE SNACKBAR STYLES
    link(href='public/stylesheets/temp/snackbar.css',     rel='stylesheet')
    //- TEMPLATE TABLE STYLES
    link(href='public/stylesheets/temp/table-style.css',     rel='stylesheet')
    //- CUSTOM style
    link(href="public/stylesheets/style.css" rel='stylesheet')
    //- TABLE SORTER STYLE
    link(href='public/__jquery.tablesorter/themes/blue/style.css' rel="stylesheet" type="text/css")
    //- SEAT CHART PLUG-IN
    link(href='public/stylesheets/temp/jquery.seat-charts.css' rel='stylesheet')
    //- SEAT CHART CUSTOM STYLE
    link(href='public/stylesheets/temp/seat-chart-custom.css' rel='stylesheet')
    link(href='public/stylesheets/temp/sales.css' rel='stylesheet')
  body
    #recharge-form.modal
      form.modal-content.animate
        .col-4
          label ID
            | 
            input#choose-member(name='choose-member' placeholder='ID를 입력해주세요.')
            //- javascript dynamically insert members
        .col-4
          label
            | 요금제
            select#choose-payment
            //- javascript dynamically insert payments
        .col-4
          label
            | 충전하실 금액을 입력해주세요.
            input#choose-cash(name='recharge-cash' placeholder='요금제일 때만 입력해주세요.' disabled='true')
        .col-4
          label
            | 할인금액
            input#choose-discount(name='discount-cash' placeholder='할인금액')
        //- .col-1
        //-   label
        //-     | 야간 월권 추가
        //-     center(style='position:relative;margin-bottom:8px;')
        //-       input.switchery.js-switch(type='checkbox' name='using-night')
        .col-submit
          button.submitbtn#charge-btn 충전하기
        input(type='hidden' name='minPerDay')
        input(type='hidden' name='member')
        input(type='hidden' name='paymentId')
        input(type='hidden' name='type')
        input(type='hidden' name='price')
    //- USAGE LIST
    #member-usage-list-modal.modal(style='padding-top:0;padding-bottom:0;z-index:2;')
      .sell-product-modal-wrapper.modal-content.container.animate(style="width:70%; height:98%; padding:20px; padding-top:30px; margin-top:10px;")
        h1.page-subhead-line(style="font-size:18px; text-align:center") 사용자 사용내역입니다.
        .row
          .col-md-12
            .form-inline
              .form-group
                label.inline-label 조회 날짜
                .input-group.date#member-usage-datetimepicker-start
                  input.form-control(type='text' style='font-size:11px;')
                  span.input-group-addon
                    span.fa.fa-calendar(aria-hidden='true')
                label.inline-label ~
                .input-group.date#member-usage-datetimepicker-end
                  input.form-control(type='text' style='font-size:11px;')
                  span.input-group-addon
                    span.fa.fa-calendar(aria-hidden='true')
                label.inline-label 이름
                label.inline-label#member-usage-list-name
                label.inline-label 아이디
                label.inline-label#member-usage-list-id
        hr
        .row
          .col-md-12
            .table-responsive-vertical.shadow-z-1.scroll-table(style='width:100%;height:32%')
              //- Table starts here
              table#member-usage-table.table.table-hover.table-bordered.table-mc-light-blue.tablesorter(style='width:100%')
                thead
                  tr
                    th 판매 내역
                    th 옵션
                    th 수량
                    th 할인
                    th 미납
                    th 금액
                    th 판매 일자
                    th 납부 방법
                    th 납부 일자
                    th
                    th(style='display:"none"')
                tbody#member-usage-table-body
    //- SELL PRODUCT MODAL
    #sell-product-modal.modal(style='padding-top:0;padding-bottom:0;z-index:2;')
      .sell-product-modal-wrapper.modal-content.container.animate(style="width:70%; height:98%; padding:20px; padding-top:30px; margin-top:10px;")
        h1.page-subhead-line(style="font-size:18px; text-align:center") 상품 판매 화면입니다.
        .row
          .col-md-11(style="padding-right:0px; margin-left:5%")
            .row
              .col-md-6
                .input-group
                  .input-group-addon
                    i.fa.fa-search(aria-hidden="true")
                  input#products-filter.form-control(type="text" placeholder='상품이름으로 검색' onkeyup="product_finder()")
                hr
                .table-responsive-vertical.shadow-z-1.scroll-table(style='width:100%;height:32%')
                  //- Table starts here
                  table#product-table.table.table-hover.table-bordered.table-mc-light-blue.tablesorter(style='width:100%')
                    thead
                      tr
                        th 상품명
                        th 그룹
                        th 가격
                        th 설명
                        th
                        th(style="display='none'")
                    tbody#product-table-body
                .main-box.mb-dull(style='padding:5px;margin-top:30px;margin-left:30%;width:40%')
                  a#add-product.a-cursor-pointer
                    h6 추가
                .table-responsive-vertical.shadow-z-1.scroll-table(style='width:100%;height:32%')
                  //- Table starts here
                  table#product-table.table.table-hover.table-bordered.table-mc-light-blue.tablesorter(style='width:100%')
                    thead
                      tr
                        th 장바구니 상품
                        th 옵션
                        th 수량
                        th 가격
                        th 할인
                        th 미납
                        th
                        th(style="display='none'")
                    tbody#product-table-body
              .col-md-6
                .sub-wrapper(style='border: 1px solid black;height:85%')
                  h1.page-subhead-line(style='text-align: center; font-size:18px') 결제정보
                  .sales-content(style='font-size:11px;')
                    .panel.panel-default.sale-panel.inline-panel
                      .panel-heading 이름
                      .panel-body#sales-name
                    .panel.panel-default.sale-panel.inline-panel
                      .panel-heading 코업머니
                      .panel-body#sales-coupmoney
                    hr
                    .panel.panel-default.sale-panel.inline-panel
                      .panel-heading 합계 금액
                      .panel-body#sales-total
                    .panel.panel-default.sale-panel.inline-panel
                      .panel-heading 할인 금액
                      .panel-body#sales-discount
                    .panel.panel-default.sale-panel.inline-panel
                      .panel-heading 미납 금액
                      .panel-body#sales-discount  
                    .panel.panel-default.sale-panel.inline-panel
                      .panel-heading 결제 금액
                      .panel-body#sales-final      
                    hr
                    .panel.panel-default.sale-panel.inline-panel
                      .panel-heading 결제 방법
                      .panel-body
                        select.form-control#sales-option(style='font-size:11px;')
                          option(name='0')  현금
                          option(name='1')  카드
                          option(name='2')  무통장
                          option(name='3')  기타
                    .panel.panel-default.sale-panel
                      .panel-heading 납부 날짜
                      .panel-body
                        .input-group.date#sales-payday-datetimepicker
                          input.form-control(type='text' style='font-size:11px;')
                          span.input-group-addon
                            span.fa.fa-calendar(aria-hidden='true')
                    .panel.panel-default.sale-panel
                      .panel-heading 메모
                      .panel-body
                        input.form-control#sales-memo(type='text' style='font-size:11px;' placeholder='입력해주세요.')
                          
                    
    //- DISPLAY ALL MEMBERS LIST
    #all-members-list.modal(style='padding-top:0;padding-bottom:0')
      .all-members-list-wrapper.modal-content.container(style="width:95%; height:100%; padding:20px; padding-top:30px; margin-top:10px;")
        h1.page-subhead-line(style="font-size:20px; text-align:center") 회원 목록입니다.
        .row
          .col-md-2.col-md-offset-10
            .input-group
              .input-group-addon
                i.fa.fa-search(aria-hidden="true")
              input#all-members-filter.form-control(type="text" placeholder='이름으로 검색' onkeyup="all_members_finder()")
        .row
          .col-md-12
            .table-responsive-vertical.shadow-z-1.scroll-table(style='width:100%; margin-top:1%; height:75%')
              //- Table starts here
              table#all-members-table.table.table-hover.table-bordered.table-mc-light-blue.tablesorter
                thead
                  tr
                    th ID
                    th 이름
                    th 요금제
                    th 잔여시간(일)
                    th 좌석
                    th 성별
                    th 준비시험
                    th 코업머니
                    th 메모
                    th
                tbody#all-members-table-body
              
    //- DISPLAY ACTIVE MEMBERS LIST
    #active-members-list.modal(style='padding-top:10px;')
      .active-members-list-wrapper.modal-content.container(style="width:90%; height:100%; padding:20px; padding-top:30px; margin-top:10px;")
        h1.page-subhead-line(style="font-size:20px; text-align:center") 사용 중인 회원 목록입니다.
        .row
          .col-md-2.col-md-offset-10
            .input-group
              .input-group-addon
                i.fa.fa-search(aria-hidden="true")
              input#active-members-filter.form-control(type="text" placeholder='이름으로 검색' onkeyup="active_members_finder()")
        .row
          .col-md-12
            .table-responsive-vertical.shadow-z-1.scroll-table(style='width:100%; margin-top:1%; height:75%')
              //- Table starts here
              table#active-members-table.table.table-hover.table-bordered.table-mc-light-blue.tablesorter
                thead
                  tr
                    th ID
                    th 이름
                    th 요금제
                    th 입실시간
                    th 정지/퇴실시간
                    th 사용시간(분)
                    th 일시정지 여부
                    th 휴식시간(누적)
                    th 일시정지 시간
                    th 퇴실처리하기
                tbody#active-members-table-body
              //- DISPLAY ACTIVE MEMBERS LIST
    #history-modal.modal(style='padding-top:10px;')
      .table-responsive-vertical.shadow-z-1.scroll-table.modal-content(style='width:40%; margin-top:3%')
        //- Table starts here
        table#history-table.table.table-hover.table-bordered
          thead
            tr
              th 시간
              th ID
              th 이름
              th 좌석번호
              th 상태
          tbody#history-table-body
        //- DISPLAY ACTIVE MEMBERS LIST
    //- DISPLAY ACCOUNT
    #account-list.modal(style='padding-top:0px;overflow-y:scroll')
      .modal-content.animate#account-wrapper(style='width:80%; padding-top:20px; margin-top:3%;')
        #account-head.container
          h1.page-subhead-line 장부 조회
          .col-md-2.col-md-offset-2
            .form-group
              #datetimepickerMin.input-group.date
                input.form-control(type='text' name='mindate' placeholder='시작 날짜')
                span.input-group-addon
                  span.fa.fa-calendar(area-hidden='true')
          .col-md-2
            .form-group
              #datetimepickerMax.input-group.date
                input.form-control(type='text' name='maxdate' placeholder='마지막 날짜')
                span.input-group-addon
                  span.fa.fa-calendar(area-hidden='true')
          .col-md-2
            .main-box.mb-dull
              a#view-account-list
                h6 보기
        .container#account-list-container
          .com-md-12
            form#add-account-list
              .col-4
                label
                  | 내용
                  input(placeholder='내용을 입력해주세요.', name='account-content', required='required')
              .col-4.switch
                label 수입<->지출
                center(style='position:relative;margin-bottom:8px;')
                  input.switchery.js-switch(type='checkbox' name='account-inout')
              .col-4
                label
                  | 금액
                  input(name='account-price', type='text', required='required')
              .col-4
                label
                  | 서비스
                  input(name='account-service' type='text')
              .col-submit
                button.submitbtn#account-submit 등록하기
              //-THERE'S HIDDEN FORM TO SEND TOKENS
        script.
          //-
          //- turn on/off switch action
          //-
          var elems = Array.prototype.slice.call(document.querySelectorAll('.js-switch'));
          elems.forEach(function(html) {
          var switchery = new Switchery(html);
          });

        .container
          .col-md-12
            h1.page-subhead-line 장부 목록
            .table-responsive-vertical.shadow-z-1.scroll-table(style='width:100%')
              //- Table starts here
              table#account-table.table.table-hover.table-bordered.table-mc-light-blue
                thead
                  tr
                    th 일자
                    th 내용
                    th 수입/지출
                    th 금액
                    th
                    th(style="display='none'")
                tbody#account-table-body
                //- DISPLAY ACCOUNT
    //- Payback modal
    #payback-modal.modal
      .modal-content.animate(style='width:40%')
        form
          .col-2
            label
              | ID 
              input#payback-name(placeholder='ID를 입력해주세요.' name='alias' required='required')
          .col-2
            button.submitbtn#payback-submit 검색
        .container#payback-hidden-container(style='display:none; width:100%')
          .row
            .col-md-12
              #payback-result(style='padding-top:5%;padding-bottom:5%;padding-left:10%')
          .row
            #payback-submitform(style='display:none')
              .col-md-6.form-group
                input.form-control#payback-cashback(type='text' placeholder='환불 마일리지를 입력해주세요.' )
              .col-md-6
                .main-box.mb-dull
                  a#payback-determine.a-cursor-pointer
                    h6 환불하기
    //- Holdoff modal
    #holdoff-modal.modal      
      .modal-content.animate(style='width:40%')
        form
          .col-2
            label
              | ID 
              input#holdoff-name(placeholder='ID를 입력해주세요.' name='alias' required='required')
          .col-2
            button.submitbtn#holdoff-submit 검색
        .container#holdoff-hidden-container(style='display:none; width:100%')
          .row
            .col-md-12
              #holdoff-result(style='padding-top:5%;padding-bottom:5%;padding-left:10%')
          .row
            .col-md-12
              .main-box.mb-dull
                a#holdoff-determine.a-cursor-pointer
                  h6 상태변경하기
        
    //- Use milage modal
    #use-milage-modal.modal(style='padding-top:0px')
      form.modal-content.animate(style='width:60%')
        .col-2
          label
            | ID
            input#use-milage-name(placeholder='ID를 입력해주세요.', name='membername', required='required')
        .col-2
          label
            | 마일리지
            input#amount-use-milage(placeholder='사용할 마일리지를 입력해주세요.' name='milage', type='text', required='required')
        .col-2
          label
            | 내용
            input#content-use-milage(placeholder='내용.' name='content', type='text', required='required')
        .col-submit
          button.submitbtn#use-milage-submit 사용하기
        //-THERE'S HIDDEN FORM TO SEND TOKENS
        input(type='hidden' name='accessToken')
        input(type='hidden' name='refreshToken')
    //- Charge milage
    #charge-milage-modal.modal(style='padding-top:0px')
      form.modal-content.animate(style='width:60%')
        .col-2
          label
            | ID
            input#charge-milage-name(placeholder='ID를 입력해주세요.', name='membername', required='required')
        .col-2
          label
            | 마일리지
            input#amount-charge-milage(placeholder='충전할 마일리지를 입력해주세요.' name='milage', type='text', required='required')
        .col-2
          label
            | 내용
            input#content-charge-milage(placeholder='내용.' name='content', type='text', required='required')
        .col-submit
          button.submitbtn#charge-milage-submit 충전하기
        //-THERE'S HIDDEN FORM TO SEND TOKENS
        input(type='hidden' name='accessToken')
        input(type='hidden' name='refreshToken')
    #main
      //- TOP NAV BAR
      ul#top_nav
        li#top_nav_list 
          a.a-cursor-pointer(onclick="document.getElementById('register-form').style.display='block'", style='width:auto;') 등록
        li#top_nav_list
          a#clients_page(style='cursor: pointer') 사용자 페이지
        li#top_nav_list
          a#accountPage(style='cursor: pointer') 회계 페이지
        
        
      //block content
      //- /. NAV SIDE
      #wrapper
        #page-wrapper
          #page-inner
            .row
              .col-md-6(style='padding-left:30px; padding-right:30px')
                .row
                  .col-md-12
                    h1.page-head-line 도구 모음
                .row
                  .col-md-6
                    .main-box.mb-dull(style='margin-right:20px; margin-left:20px')
                      a#all-members.a-cursor-pointer
                        i.fa.fa-bolt.fa-5x
                        h5 명이 등록하였습니다.
                  .col-md-6
                    .main-box.mb-dull(style='margin-right:20px; margin-left:20px')
                      a#active-members
                        i.fa.fa-plug.fa-5x
                        h5 명이 이용 중입니다.
                .row  
                  .col-md-6
                    .main-box.mb-dull(style='margin-right:20px; margin-left:20px')
                      a#recharge.a-cursor-pointer
                        i.fa.fa-dollar.fa-5x
                        h5 요금제 등록
                  .col-md-6
                    .main-box.mb-dull(style='margin-right:20px; margin-left:20px')
                      a#reserve-studyroom.a-cursor-pointer
                        i.fa.fa-check-square-o.fa-5x
                        h5 스터디룸 예약
                .row
                  .col-md-6
                    .main-box.mb-dull(style='margin-right:20px; margin-left:20px')
                      a#account-management.a-cursor-pointer
                        i.fa.fa-book.fa-5x
                        h5 장부 관리
                  .col-md-6
                    .main-box.mb-dull(style='margin-right:20px; margin-left:20px')
                      a#use-milage.a-cursor-pointer
                        i.fa.fa-minus-square.fa-5x
                        h5 마일리지 사용
                .row
                  .col-md-6
                    .main-box.mb-dull(style='margin-right:20px; margin-left:20px')
                      a#charge-milage.a-cursor-pointer
                        i.fa.fa-plus-square.fa-5x
                        h5 마일리지 충전
                  .col-md-6
                    .main-box.mb-dull(style='margin-right:20px; margin-left:20px')
                      a#payback.a-cursor-pointer
                        i.fa.fa-reply.fa-5x
                        h5 환불
                .row
                  .col-md-6
                    .main-box.mb-dull(style='margin-right:20px; margin-left:20px')
                      a#holdoff.a-cursor-pointer
                        i.fa.fa-pause.fa-5x
                        h5 사용보류
                  .col-md-6
                    .main-box.mb-dull(style='margin-right:20px; margin-left:20px')
                      a#history.a-cursor-pointer
                        i.fa.fa-history.fa-5x
                        h5 사용기록
              .col-md-6(style='padding-left:30px; padding-right:30px')
                .row
                  .col-md-12
                    h1.page-head-line 퇴실 필요 회원들 
                .row
                  .col-md-12
                    .scroll-table(style='margin-right:40px; margin-left:40px; height: 70%')
                      .table-responsive-vertical.shadow-z-1
                        //- Table starts here
                        table#table.table.table-hover.table-bordered.table-mc-light-blue
                          thead
                            tr
                              th ID
                              th 좌석번호
                              th 잔여시간 (분)
                              th 
                          tbody#alert-member-table-body
      //- This is for rendering client page
      form#to-client-page(action='/clients/index' method='post')
        input(type='hidden' name='accessToken')
        input(type='hidden' name='refreshToken')
      #wrapper
        #page-wrapper
          #page-inner
            .row
              .col-md-12
                h1.page-head-line(style='text-align:center') 좌석 현황
                h1.page-subhead-line(style='text-align:center;') 새로고침을 누른 후 좌석이동을 해주세요. <br><br>좌석에 마우스를 올려 놓으면 회원 이름을 확인 할 수 있습니다.
            .row
              .row
                .col-md-3.col-md-offset-1
                  .room-container
                    .booking-details
                      h1.page-subhead-line(style='text-align:center; font-size: 30px') 3층 좌석
                      hr
                      #seat-map-3f
                      hr
                      #legend-3f
                .col-md-3.col-md-offset-4
                  .room-container
                    .booking-details
                      h1.page-subhead-line(style='text-align:center; font-size: 30px') 4층 좌석
                      hr
                      #seat-map-4f
                      hr
                      #legend-4f
              hr
              .row
                .col-md-3.col-md-offset-1
                  .main-box.mb-dull(style='margin-right:20px; margin-left:20px;')
                    a#seat-refresh.a-cursor-pointer
                      h5 새로고침
                .col-md-2
                  input.form-control#oldseat(type='text' placeholder='바꿀 자리')
                .col-md-2
                  input.form-control#newseat(type='text' placeholder='새 자리')
                .col-md-3
                  .main-box.mb-dull(style='margin-right:20px; margin-left:20px;')
                    a#seat-change.a-cursor-pointer
                      h5 좌석 이동
              
              
    
    //- --------------------------------------------------------------------------------------------------------
    //- SNACKBAR                
    //- --------------------------------------------------------------------------------------------------------
    #snackbar
      | 성공적으로 등록되었습니다.
    #still-use-other-payment-snackbar
      | 아직 다른 요금제를 사용중입니다. 환불 절차를 먼저 거쳐주세요.
    #lack-of-milage-err-snackbar
      | 마일리지가 부족합니다.
    #success-at-using-milage-snackbar
      | 마일리지를 사용하였습니다.
    #phonenum-length-err-snackbar
      | 휴대폰 번호를 정확히 입력해주세요.
    #password-length-err-snackbar
      | 비밀번호가 정확하지 않습니다.
    #already-reigster-err-snackbar
      | 이미 등록된 회원입니다.
    
    script.
      //- Set the width of the side navigation to 250px and the left margin of the page content to 250px 
      function openNav() {
        document.getElementById('mySidenav').style.width = "250px";
        document.getElementById('main').style.marginLeft ="250px";
      }
      //- Set the width of the side navigation to 0 and the left margin of the page content to 0 
      function closeNav() {
        document.getElementById('mySidenav').style.width = '0';
        document.getElementById('main').style.marginLeft = '0';
      }    

            
    //- JQUERY SCRIPTS
    script(src='public/javascripts/temp/jquery-1.10.2.js')
    //- BOOTSTRAP SCRIPTS
    script(src='public/javascripts/temp/bootstrap.js')
    //- METISMENU SCRIPTS
    script(src='public/javascripts/temp/jquery.metisMenu.js')
    //- TEMPLATE LAYOUT SCRIPTS
    script(src='public/javascripts/temp/custom.js')
    //- BOOTSTRAP EONASDAN-BOOTSTRAP-DATEPICKER
    script(type='text/javascript', src='/bower_components/jquery/dist/jquery.min.js')
    script(type='text/javascript', src='/bower_components/moment/min/moment.min.js')
    script(type='text/javascript', src='/bower_components/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js')
    link(rel='stylesheet', href='/bower_components/eonasdan-bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.min.css')
    //- TABLE SORTER
    //-script(type='text/javascript', src='public/javascripts/temp/jquery-latest.js')
    script(type='text/javascript', src='public/__jquery.tablesorter/jquery.tablesorter.min.js')
    //- TEMPLATE LAYOUT SCRIPTS
    script(type='text/javascript', src='public/javascripts/temp/custom.js')
    script(type='text/javascript', src='public/javascripts/temp/jquery.seat-charts.min.js')
    //- CUSTOM SCRIPTS
    script.
      $(document).ready(function() {
        
        
        //-
        //-  *  this script is for saving token to localStorage.
        //-     And attach the token to subsequent calls.
        //-
        //-  *  [This is not implemented] 
        //-     If there's no tokens from server, jump this part
        //-
        //- maybe need more validation

        //- form submit action
        $('#registerSubmit').click(function(event) {
          event.preventDefault();
          /* send sex check box data */
          var membername = $('#name').val();
          var password   = $('#Password').val();
          var phonenum   = $('#phone').val();
          var prepare    = $('#prepare').val();
          var memo       = $('#memo').val();
          var sex = $('#sex').is(':checked');
          alert(membername+":"+password+":"+phonenum+":"+sex);
          $.ajax({
            url: '/register',
            method: 'post',
            data: {
              membername: membername,
              password: password,
              phonenum: phonenum,
              prepare: prepare,
              memo: memo,
              sex: sex
            }
          }).done(function(results) {
            console.log(results);
            if (results == "0") {
              alert('등록에 성공했습니다.');
            }
            else if(results == "1") {
              alert("휴대폰 번호를 정확히 입력해주세요.");
            }
            else if(results == "2") {
              alert("휴대폰 번호를 정확히 입력해주세요.");
            }
            else if(results == "3") {
              alert("이미 등록된 회원입니다. ");
            }
            else if(results == "4") {
              alert("이미 등록된 회원입니다.");
            }
            // reset input
            $('#name').val("");
            $('#Password').val("");
            $('#phone').val("");
            $('#prepare').val("");
            $('#memo').val("");
            $('#sex').attr("checked", false);
            $('.switchery')
              .css("box-shadow", "rgb(223, 223, 223) 0px 0px 0px 0px inset")
              .css("border-color", "rgb(223, 223, 223)")
              .css("background-color", "rgb(255, 255, 255)");
            $('.switchery > small').css("left", "0px");
          });
          
        });
        
        //-
        //- When the user clicks anywhere outside of the modal, close it
        //-
        
        window.onclick = function(event) {
          var register            = document.getElementById('register-form');    
          var recharge            = document.getElementById('recharge-form');
          var active_members_list = document.getElementById('active-members-list');
          var all_members_list    = document.getElementById('all-members-list');
          var account_list        = document.getElementById('account-list');
          var use_milage          = document.getElementById('use-milage-modal');    
          var charge_milage       = document.getElementById('charge-milage-modal');
          var reserve_studyroom   = document.getElementById('studyroom-reservation-modal');
          var payback             = document.getElementById('payback-modal');
          var holdoff             = document.getElementById('holdoff-modal');
          var history             = document.getElementById('history-modal');
          
          var sell_product        = document.getElementById('sell-product-modal');
          
          if(event.target == sell_product) {
            sell_product.style.display = "none";
            return false;
          }
        
          if (event.target == holdoff) {
            holdoff.style.display = "none";
            var holdoffId = document.getElementById("holdoff-name").value = "";
            var wrapper   = document.getElementById("holdoff-hidden-container");
            var container = document.getElementById("holdoff-result"); 
            
            wrapper.style.display = "none";
            while(container.firstChild) {
              container.removeChild(container.firstChild);
            }
            
            return false;
          }
          
          if (event.target == payback) {
            payback.style.display = "none";
            var paybackId = document.getElementById("payback-name").value = "";
            var container = document.getElementById("payback-result");
            var submitform= document.getElementById("payback-submitform");
            
            container.style.display = "none";
            while (container.firstChild) {
              container.removeChild(container.firstChild);
            }
            submitform.style.display = "none";
            
            return false;
          }
          
          if (event.target == recharge) {
            recharge.style.display = "none";
            var paymentList = document.getElementById("choose-payment");
            var memberList  = document.getElementById("choose-member");
            var cash        = document.getElementById("choose-cash");
            
            while(paymentList.firstChild) {
              paymentList.removeChild(paymentList.firstChild);
            }
            memberList.value = "";
            cash.value = "";
            
            return false;
          }
          
          if (event.target == register) {
              register.style.display = "none";
              
              return false;
          }
          
          if(event.target == active_members_list) {
            active_members_list.style.display = "none";
            var tbody = document.getElementById("active-members-table-body");
            /* and also should erase their children */
            while(tbody.firstChild) {
              tbody.removeChild(tbody.firstChild);
            }
            
            return false;
          }
          
          if (event.target == all_members_list) {
            all_members_list.style.display = "none";
            var tbody = document.getElementById("all-members-table-body");
            
            while (tbody.firstChild) {
              tbody.removeChild(tbody.firstChild);
            }
            
            return false;
          }
          
          if (event.target == account_list) {
            account_list.style.display = "none";
            /*
              AND also erase old value
            */
            var tbody = document.getElementById("account-table-body");
            while (tbody.firstChild) {
              tbody.removeChild(tbody.firstChild);
            }
            
            return false;
          }
          
          if (event.target == use_milage) {
            use_milage.style.display = "none";
            document.getElementById("use-milage-name").value = "";
            document.getElementById("amount-use-milage").value = "";
            
            return false;
          }
          
          if (event.target == charge_milage) {
            charge_milage.style.display = "none";
            document.getElementById("charge-milage-name").value = "";
            document.getElementById("amount-charge-milage").value = "";
            
            return false;
          }
          
          if (event.target == reserve_studyroom) {
            var select_hours_container = document.getElementById('select-hours-container');
            reserve_studyroom.style.display = "none";
            /*
              also hide select hour form
            */
            select_hours_container.style.display = 'none';
            
            return false;
          }
          
          if(event.target == history) {
            history.style.display = "none";
            var history_table = document.getElementById('history-table-body');
            while(history_table.firstChild) {
              history_table.removeChild(history_table.firstChild);
            }
            return false;
          }
        }// end of function

        /* *******************************************************8
          SNACKBAR 
        ***************************************************************/
        function show_snackbar(id) {
          //- Get the snackbar
          var sb = document.getElementById(id);
          //- Add the class
          sb.className = "show";
          //- After 3 seconds, remove the show class from snackbar
          setTimeout(function() {sb.className = sb.className.replace("show", ""); }, 3000);
        }

        if(register_succ_snackbar === "true") {show_snackbar('snackbar'); return false;}
        if(phonenum_length_err === "1") {show_snackbar('phonenum-length-err-snackbar'); return false;}
        if(password_length_err === "1") {show_snackbar('password-length-err-snackbar'); return false;}
        if(recharge_succ === "1") {show_snackbar('snackbar'); return false;}
        if(recharge_succ === "0") {show_snackbar('still-use-other-payment-snackbar'); return false;}
        if(already_register_err === "1"){show_snackbar('already-reigster-err-snackbar'); return false;}
        
        //- END OF SNACKBAR
        
        /*
          All member list button clicked
        */
        var len;
        $('a#all-members').click(function(event) {
          /* get the token */
          
          $.ajax({
            url: '/system/all-members',
            method: 'post',
          }).done(function(results) {
            var json = JSON.parse(results);
            var memberList = json.memberList;
            var pnameList  = json.pnameList;

            for (var i = 0; i < pnameList.length; i++) {
              var o = memberList[i];
              var sex;
              if (o.sex === 0) sex = "남";
              else             sex = "여";
              
              $('#all-members-table-body').append(
                '<tr name="member-'+i+'">'+
                ' <td data-title="ID">'+ o.alias +'</td>' +
                ' <td data-title="membername">'+ o.membername +'</td>' +
                ' <td data-title="payment">'+ pnameList[i]  +'</td>' +
                ' <td data-title="leftDay">'+ o.leftDay +'</td>' +
                ' <td date-title="seat">'+ o.seatnum+'</td>' +
                ' <td date-title="sex">'+ sex +'</td>' +
                ' <td date-title="prepare">' + o.prepare +'</td>' +
                ' <td date-title="milage">' + o.milage +'</td>' + 
                ' <td date-title="memo">' + o.memo +'</td>' + 
                ' <td date-title="modify">' +
                '   <i class="fa fa-pencil-square-o modify-member fa-2x" aria-hidden="true" style="cursor:pointer" title="회원정보변경"></i> &nbsp;' +
                '   <i class="fa fa-trash-o delete-member fa-2x" aria-hidden="true" style="cursor:pointer" title="회원삭제"></i> &nbsp;' +
                '   <i class="fa fa-list-alt list-member-usage fa-2x" aria-hidden="true" style="cursor:pointer" title="이용내역"></i> &nbsp;' +
                '   <i class="fa fa-money sell-product fa-2x" aria-hidden="true" style="cursor:pointer" title="상품판매"></i> &nbsp;' +
                ' </td>' +
                '</tr>'
              );
              /*
                all member MODIFY click event handler
              */
              $('tr[name="member-'+i+'"] td i.modify-member').on('click', function(event) {
                var $parent = $(this).parent().parent('tr');
                var id = $parent.find('td:eq(0)').text();
                var editable = $parent.find('td:eq(1)').attr("contenteditable");
                if (editable === undefined || editable == 'false') {
                  alert("내용을 변경한 뒤 다시한번 클릭해주세요. \n\n <수정가능목록> \n  1. 이름\n  2. 잔여 일\n  3. 성별\n  4. 준비시험\n  5. 메모");
                  $parent.find('td:eq(1)').attr("contenteditable", true); // membername
                  //$parent.find('td:eq(2)').attr("contenteditable", true);
                  $parent.find('td:eq(3)').attr("contenteditable", true); // left day
                  //$parent.find('td:eq(4)').attr("contenteditable", true);
                  $parent.find('td:eq(5)').attr("contenteditable", true);
                  $parent.find('td:eq(6)').attr("contenteditable", true);
                  $parent.find('td:eq(8)').attr("contenteditable", true);
                  return false;
                }
                else if (editable == 'true'){
                  
                  $parent.find('td:eq(1)').attr("contenteditable", false);
                  //$parent.find('td:eq(2)').attr("contenteditable", false);
                  $parent.find('td:eq(3)').attr("contenteditable", false);
                  //$parent.find('td:eq(4)').attr("contenteditable", false);
                  $parent.find('td:eq(5)').attr("contenteditable", false);
                  $parent.find('td:eq(6)').attr("contenteditable", false);
                  $parent.find('td:eq(8)').attr("contenteditable", false);
                  
                  /* should pack modified data and ajax */
                  var membername  = $parent.find('td:eq(1)').text();
                  //var payment     = $parent.find('td:eq(2)').text();
                  var leftDay     = $parent.find('td:eq(3)').text();
                  var sex         = $parent.find('td:eq(5)').text();
                  var prepare     = $parent.find('td:eq(6)').text();
                  var memo        = $parent.find('td:eq(8)').text();
                  
                  $.ajax({
                    url: '/system/modify-member-info',
                    method: 'post',
                    data: {
                      id: id,
                      membername: membername,
                      leftDay: leftDay,
                      //payment: payment,
                      sex: sex,
                      prepare: prepare,
                      memo: memo
                    }
                  }).done(function(result) {
                    alert('변경되었습니다.');
                  });
                }
              });
              /*
                all member DELETE click event handler
              */
              $('tr[name="member-'+i+'"] td i.delete-member').on('click', function(event) {
                var r = confirm("삭제하시겠습니까?");
                if (r == true) {
                  var $parent = $(this).parent().parent('tr');
                  var id = $parent.find('td:eq(0)').text();
                  
                  $.ajax({
                    url: '/system/delete-member-info',
                    method: 'post',
                    data: {id: id}
                  }).done(function(result) {
                    alert('삭제되었습니다.');
                  });
                }
              });
              
              /*
                all member SELL PRODUCT click event handler
              */
              $('tr[name="member-'+i+'"] td i.sell-product').on('click', function(event) {
                $('#sell-product-modal').css("display", "block");
              });
              
              /*
                all member LIST USAGE click event handler
              */
              $('tr[name="member-'+i+'"] td i.list-member-usage').on('click', function(event) {
                $('#member-usage-list-modal').css("display", "block");
              });
            }
            /*
              All members table sorter
            */
            $('#all-members-table').tablesorter();  
            
            $('#all-members-list').css("display", "block");
          });          
        });
        
        
        
        /*
          Active member list button clicked 
        */
        $('a#active-members').click(function(event) {
          /* get the token */
          $.ajax({
            url: '/system/active-members',
            method: 'post',
          }).done(function(results) {
            var json = JSON.parse(results);
            console.log(json);
            
            for (var i = 0; i < json.length; i++) {
              var jsonObj = json[i];
              var ispause = '-';
              if (jsonObj.pause === '1') ispause = '일시정지 중';
              var total = parseInt(jsonObj.usedMin);
              var hour  = parseInt(total / 60);
              var min   = total % 60;
              
              var btotal = parseInt(jsonObj.break);
              var bhour  = parseInt(btotal/60);
              var bmin   = btotal % 60;
              $('#active-members-table-body').append(
                '<tr name="active-member-'+i+'">'+
                ' <td data-title="ID">'+ jsonObj.alias +'</td>' +
                ' <td data-title="membername">'+ jsonObj.membername +'</td>' +
                ' <td data-title="payment">'+ jsonObj.payment +'</td>' +
                ' <td data-title="enterts">'+ jsonObj['DATE_FORMAT(ts, "%Y-%m-%d %H:%i")'] +'</td>' +
                ' <td data-title="fints">'+ jsonObj.lts +'</td>' +
                ' <td data-title="usedMin">'+ hour +' 시간 '+ min +' 분'+'</td>' +
                ' <td date-title="ispause">'+ ispause+'</td>' +
                ' <td date-title="break">'+  bhour +' 시간 '+ bmin +' 분'+'</td>' +
                ' <td date-title="pts">'+ jsonObj.pts +'</td>' +
                ' <td date-title="vacant"><i class="fa fa-times vacant-seat" aria-hidden="true" style="cursor:pointer"></i></td>' +
                '</tr>'
              );
              
              /*
                all member VACANT-SEAT click event handler
              */
              $('tr[name="active-member-'+i+'"] td i.vacant-seat').on('click', function(event) {
                var $parent = $(this).parent().parent('tr');
                var alias = $parent.find('td:eq(0)').text();
                
                $.ajax({
                  url: '/system/vacant-seat',
                  method: 'post',
                  data: {alias: alias}
                }).done(function(result) {
                  if (result == "0") {
                    alert('퇴실처리 하였습니다.');
                    //$parent.parent().remove('tr[name="active-member-'+i+'"]');
                  }
                });
              });
            }
            $('#active-members-table').tablesorter();  
            
            $('#active-members-list').css("display", "block");
          });          
        });
        
        
        /*
          member's sales window datetimepicker
        */
        $('#sales-payday-datetimepicker').datetimepicker({
          useCurrent: true,
          widgetPositioning: {vertical: 'top'},
        });
        $('#sales-payday-datetimepicker').data("DateTimePicker").format('YYYY-MM-DD');
        
        /*
          member's usage list datetimepicker
        */
        $('#member-usage-datetimepicker-start').datetimepicker({
          useCurrent: true,
          widgetPositioning: {vertical: 'top'}
        });
        $('#member-usage-datetimepicker-start').data("DateTimePicker").format('YYYY-MM-DD');
        $('#member-usage-datetimepicker-end').datetimepicker({
          useCurrent: true,
          widgetPositioning: {vertical: 'top'}
        });
        $('#member-usage-datetimepicker-end').data("DateTimePicker").format('YYYY-MM-DD');
        
        /*
          Payback
        */
        $('a#payback').click(function(event) {
          $('#payback-modal').css("display", "block");
        });
        $('#payback-submit').click(function(event) {
          event.preventDefault();
          var alias = $('#payback-name').val();
          
          if (alias === "") {
            alert('ID를 입력해주세요.');
            return false;
          }
          
          $.ajax({
            url: '/system/payback',
            method: 'post',
            data: {alias: alias}
          }).done(function(results) {
            var json = JSON.parse(results);
            console.log(json);
            $('#payback-hidden-container').css('display', 'block');
            $('#payback-submitform').css('display', 'block');
            $('#payback-result').append(
              '<h4> 이름: '+json.membername+'</h4><br>' + 
              '<h4> 이용 요금제: '+json.payment+'</h4><br>' +
              '<h4> 잔여 일: '+ json.leftDay +' 일</h4><br>' +
              '<h4> 잔여 마일리지: '+json.milage+' 포인트</h4><br>' +
              '<input type="hidden" name="payback-id" value="'+ json.id +'">'
            );
          });
        });
        $('a#payback-determine').click(function(event) {
          var id = $('input[name="payback-id"]').val();
          var cashback = $('#payback-cashback').val();
          $.ajax({
            url: '/system/payback-determine',
            method: 'post',
            data: {
              id: id, 
              milage: cashback
            }
          }).done(function(result) {
            if (result == 'success') {
              alert('환불처리 되었습니다.');
              // clean up
              $('payback-hidden-container').css('display', 'none');
              var container = document.getElementById('payback-result');
              while(container.firstChild) {
                container.removeChild(container.firstChild);
              }
              $('input[name="payback-id"]').val("");
              $('#payback-name').val("");
              $('#payback-submitform').css('display', 'none');
            }
          });
        });
        
        /* show select hour container */
        $('#reservation-date').on('dp.change', function(e) {
          /*
            everytime date is change, should clear the table
          */
          $('tbody#reservation-table-body-1').children('tr').each(function() {
            $(this).find('th[name="avail"]').text('');
          });
        });
        /* if clicked hour select button -> reserve the room */
        $('#reserve-hour-select').click(function() {
          var startHour = $('#select-hours').find('option:selected').attr("name");
          var roomNum   = $('#select-room').find('option:selected').attr("name");
          var duration  = $('#duration').val();
          var users     = $('#studyroom-users').val();
          var purpose   = $('#studyroom-purpose').val();
          var reserveDateMin = $('#studyroom-datetimepickerMin').data("date");
          var reserveDateMax = $('#studyroom-datetimepickerMax').data("date");
          /* this option is for chooseing all, weekend, weekday */
          var option         = $('#select-option').find('option:selected').attr("name");

          if (startHour === '' || duration === '' || reserveDateMax === undefined) {
            alert('입력되지 않은 값이 있습니다..');
            return false;
          }
          
          
          $.ajax({
            url: '/system/reserve-studyroom',
            method: 'post',
            data: {
              sh: startHour,
              du: duration,
              rds: reserveDateMin,
              rde: reserveDateMax,
              rn: roomNum,
              users: users,
              purpose: purpose,
              option: option
            }
          }).done(function(results) {
            console.log(results);
            var json = JSON.parse(results);
            
            if (json.err == "2") {
              alert('이미 예약된 시간입니다.');
            }
            else if(json.err == "3") {
              alert('24시를 넘어서는 예약할 수 없습니다.');
            }
            else if(json.err == "4") {
              alert("운영시간이 아닙니다.");
            }
            else if(json.err == "0") {
              alert('예약에 성공했습니다.\n\n  예약 일 수 :'+json.days+' 일');
            }
            /*
              Should clear the select hour form after that..
            */
            $('#select-hours').prop('selectedIndex', 0);
            $('#duration').val('');
            $('#studyroom-users').val('');
            $('#studyroom-purpose').val('');
          });
        });
        
        /* cancel reservation */
        $('#reserve-hour-select-cancel').click(function() {
          var startHour = $('#select-hours-cancel').find('option:selected').attr("name");
          var roomNum   = $('#select-room-cancel').find('option:selected').attr("name");
          var reserveDateMin = $('#studyroom-datetimepickerMin').data("date");
          var reserveDateMax = $('#studyroom-datetimepickerMax').data("date");
          
          if (startHour === '' || duration === '' || reserveDateMax === undefined) {
            alert('입력되지 않은 값이 있습니다..');
            return false;
          }
          
          $.ajax({
            url: '/system/reserve-studyroom-cancel',
            method: 'post',
            data: {
              sh: startHour,
              rds: reserveDateMin,
              rde: reserveDateMax,
              rn: roomNum
            }
          }).done(function(results) {
            if (results == "0") {
              alert("취소하였습니다.");
              
              /*
                Should clear the select hour form after that..
              */
              $('#select-hours-cancel').prop('selectedIndex', 0);
              $('#select-room-cancel').prop('selectedIndex', 0);
            }
            else if (results == "1") {
              alert("취소실패! 취소 날짜와 시작시간을 한 번 더 확인해주세요.");
            }
          });
        });
        /*
          Display Account List 
        */
        $('#account-management').click(function(event) {
          /* before change display property, first get the old list from db */
          $('#account-list').css("display", "block");
        });
        $('#account-submit').click(function(event) {
          /* prevent go else where */
          event.preventDefault();
          
          var content     = $('input[name="account-content"]').val();
          var inout       = $('input[name="account-inout"]').is(':checked');
          var price       = $('input[name="account-price"]').val();
          var service     = $('input[name="account-service"]').val();

          $.ajax({
            url: '/system/add-account-list',
            method: 'post',
            data: {
              content: content,
              inout: inout,
              price: price,
              service: service
            }
          }).done(function(results) {
            alert('등록되었습니다.');
            $('input[name="account-inout"]').prop("checked", false);
          });
          /*
            empty the field
          */
          $('input[name="account-content"]').val("");
          $('input[name="account-inout"]').attr("checked", false);
          $('.switchery')
            .css("box-shadow", "rgb(223, 223, 223) 0px 0px 0px 0px inset")
            .css("border-color", "rgb(223, 223, 223)")
            .css("background-color", "rgb(255, 255, 255)");
          $('.switchery > small').css("left", "0px");
          $('input[name="account-price"]').val("");
        })
        /*
          Datepicker Display - Account list
        */
        $('#datetimepickerMin').datetimepicker({format: 'YYYY-MM-DD'});
        $('#datetimepickerMax').datetimepicker({
          useCurrent: false, //Important! See issue #1075
          format: 'YYYY-MM-DD'
        });
        $("#datetimepickerMin").on("dp.change", function (e) {
          $('#datetimepickerMax').data("DateTimePicker").minDate(e.date);
        });
        $("#datetimepickerMax").on("dp.change", function (e) {
          $('#datetimepickerMin').data("DateTimePicker").maxDate(e.date);
        });
        
        /*
          Datepicker Display - studyroom list
        */
        $('#studyroom-datetimepickerMin').datetimepicker({format: 'YYYY-MM-DD'});
        $('#studyroom-datetimepickerMax').datetimepicker({
          useCurrent: false, //Important! See issue #1075
          format: 'YYYY-MM-DD'
        });
        $("#studyroom-datetimepickerMin").on("dp.change", function (e) {
          $('#studyroom-datetimepickerMax').data("DateTimePicker").minDate(e.date);
        });
        $("#studyroom-datetimepickerMax").on("dp.change", function (e) {
          $('#studyroom-datetimepickerMin').data("DateTimePicker").maxDate(e.date);
        });
        
        /*
          If admin clicked btn which reserve studyroom between two dates
        */
        
        /*
          If admin clicked btn which display accoutn list between two dates
        */
        $('#view-account-list').click(function() {
          var mindate = $('#datetimepickerMin').data("date");
          var maxdate = $('#datetimepickerMax').data("date");
          console.log(mindate);
          
          if (mindate === undefined || maxdate === undefined) {
            alert('날짜를 입력해주세요.');
            return false;
          }
          /*
            should erase old value
          */
          var tbody = document.getElementById('account-table-body');
          while (tbody.firstChild) {
            tbody.removeChild(tbody.firstChild);
          }
          
          
          /*
            then ajax
          */
          $.ajax({
            url: '/system/view-account-list',
            method: 'post',
            data: {
              mindate: mindate,
              maxdate: maxdate
            }
          }).done(function(results) {
            console.log(results);
            var json = JSON.parse(results);
            
            console.log(json);
            
            for (var i = 0; i < json.length; i++) {
              var jsonelt = json[i];
              var inout;
              console.log(jsonelt.ep);
              if (jsonelt.ep == 'true') {
                inout = "지출";
              }
              else {
                inout = "수입";
              }
            
              $('tbody#account-table-body').append(
                '<tr name="row-'+i+'">'+
                ' <td data-title="ts">'+ jsonelt['DATE_FORMAT(ts, "%Y-%m-%d")'] +'</td>' +
                ' <td data-title="content">'+ jsonelt.content +'</td>' +
                ' <td data-title="inout">'+ inout +'</td>' +
                ' <td data-title="price">'+ jsonelt.price +'</td>' +
                ' <td date-title="modify">' +
                  '<i class="fa fa-pencil-square-o modify-row fa-2x" aria-hidden="true"></i>' +
                  '<i class="fa fa-trash-o delete-row fa-2x" aria-hidden="true"></i></td>' +
                ' <td date-title="id" style="display:none" name="'+parseInt(jsonelt.id) +'" >'+parseInt(jsonelt.id)+'</td>' +
                '</tr>'
              );
              
              /*
                account table MODIFY click event handler
              */
              $('tr[name="row-'+i+'"] td i.modify-row').on('click', function(event) {
                var $parent = $(this).parent().parent('tr');
                var id = $parent.find('td:eq(5)').text();
                var editable = $parent.find('td[data-title="content"]').attr("contenteditable");
                
                if (editable === undefined || editable === false) {
                  alert("내용을 변경한 뒤 다시한번 클릭해주세요.\n\n <수정가능목록> \n  1. 장부내용\n  2. 수입/지출 표시\n  3. 가격 ");
                  console.log(editable);
                  $parent.find('td:eq(1)').attr("contenteditable", true);
                  $parent.find('td:eq(2)').attr("contenteditable", true);
                  $parent.find('td:eq(3)').attr("contenteditable", true);
                  return false;
                }
                else {
                  
                  $parent.find('td:eq(1)').attr("contenteditable", false);
                  $parent.find('td:eq(2)').attr("contenteditable", false);
                  $parent.find('td:eq(3)').attr("contenteditable", false);
                
                  
                  /* should pack modified data and ajax */
                  var content = $parent.find('td:eq(1)').text();
                  var inout   = $parent.find('td:eq(2)').text();
                  var price   = $parent.find('td:eq(3)').text();
                  var id      = $parent.find('td:eq(5)').text();
                
                  $.ajax({
                    url: '/system/modify-account-list',
                    method: 'post',
                    data: {
                      content: content,
                      inout: inout,
                      price: price,
                      id: id
                    }
                  }).done(function(result) {
                    if (result === "fail") {
                      alert('변경에 실패하였습니다.(1)');
                    }
                    else {
                      alert('변경되었습니다.');                      
                    }
                  });
                }
              });
              // end of click handler
              /*
                account table DELETE click event handler
              */
              $('tr[name="row-'+i+'"] td i.delete-row').on('click', function(event) {
                var $parent = $(this).parent().parent('tr');
                var id = $parent.find('td:eq(5)').text();
                
                $.ajax({
                  url: '/system/delete-account-list',
                  method: 'post',
                  data: { id: id}
                }).done(function(result) {
                  alert("삭제하였습니다.");
                  $(this).parent().parent('tr[name="row-'+i+'"]').remove();
                });
              });
              // end of delete handler
              
              $('.modify-row').css('cursor', 'pointer');
            }
            
          });
        });
      
        /*
          Use Milage 
        */
        $('#use-milage').click(function() {
          $('#use-milage-modal').css("display", "block");          
        });
        /* when submit the form*/
        $('#use-milage-submit').click(function(event) {
          event.preventDefault();
          var valAccess  = window.localStorage.getItem('accessToken');    
          var valRefresh = window.localStorage.getItem('refreshToken');
          var membername = $('#use-milage-name').val();
          var milage     = $('#amount-use-milage').val();
          var content    = $('#content-use-milage').val();
          
          $.ajax({
            url: '/system/use-milage',
            method: 'post',
            data: {
              accessToken   : valAccess,
              refreshToken  : valRefresh,
              membername    : membername,
              milage        : milage,
              content       : content
            }
          }).done( function (results) {
            var json = JSON.parse(results);
            console.log(json);
            // show snackbar or some alert to admin
            if (json.err === "1") {
              // failed
              show_snackbar('lack-of-milage-err-snackbar');
            }
            else if(json.err === "0") {
              //success
              show_snackbar('success-at-using-milage-snackbar');
            }
            
            $('#use-milage-name').val("");
            $('#amount-use-milage').val("");
            $('#content-use-milage').val("");
          });
        });
        
        /*
          charge milage
        */
        $('#charge-milage').click(function() {
          $('#charge-milage-modal').css("display", "block");          
        });
        /* when submit the form*/
        $('#charge-milage-submit').click(function(event) {
          event.preventDefault();
          var valAccess  = window.localStorage.getItem('accessToken');    
          var valRefresh = window.localStorage.getItem('refreshToken');
          var membername = $('#charge-milage-name').val();
          var milage     = $('#amount-charge-milage').val();
          var content    = $('#content-charge-milage').val();
          
          $.ajax({
            url: '/system/charge-milage',
            method: 'post',
            data: {
              accessToken   : valAccess,
              refreshToken  : valRefresh,
              membername    : membername,
              milage        : milage,
              content       : content
            }
          }).done(function(result) {
            if (result == "success") {
              alert('충전되었습니다.');
              $('#charge-milage-name').val("");
              $('#amount-charge-milage').val("");   
              $('#content-charge-milage').val("");           
            }
            else if (result == "err1") {
              alert('ID가 잘못되었습니다.');
            }
            else if (result == "err2") {
              alert('마일리지를 잘못 입력하였습니다.');
            }
            else if (result == "err3") {
              alert('존재하지 않는 회원입니다.');
            }
          });
        });
        
        
        /*
          home link always send tokens with ajax call
        */
        $('a#home').click(function(event) {
          var valAccess  = window.localStorage.getItem('accessToken');    
          var valRefresh = window.localStorage.getItem('refreshToken'); 

          $.ajax({
            url: '/home',
            method: 'post',
            data: {
              accessToken: valAccess,
              refreshToken: valRefresh
            }
          });
        });
        //- recharge milage button clicked, inflate the recharge form
        
        /* 
          Now memArr, payArr can used globally
        */
        var memArr;
        var payArr;
        $('a#recharge').click(function(event) {
          //- When clicked, should get data from database.
          $.ajax({
            url: '/recharge',
            method: 'post'
          }).done(function(results) {
            payArr = results.paymentObj;
            console.log(payArr);
            
            
            $('#choose-payment').append("<option>선택해주세요.</option>");
            for (var i = 0; i < payArr.length; i++) {
              var paymentname;
              if(payArr[i].type === "daily") {
                paymentname = payArr[i].name + ' - 하루 단위';
              }
              else if (payArr[i].type === "monthly") {
                paymentname = payArr[i].name + ' - 월 단위';
              }
              else if (payArr[i].type === "halfmonthly") {
                paymentname = payArr[i].name + ' - 보름 단위';
              }
              else {
                paymentname = payArr[i].name;
              }
              
              $('#choose-payment').append("<option>"+paymentname+"</option>");
            }

            $('#recharge-form').css("display", "block");
                        
          });
        });

        $('#choose-payment').on('change',$(this), function(event) {
          /* if change first erae the cash value */
          
          var val = $(this).prop('selectedIndex');
          if(val === 1) {
            $("#choose-cash").attr("disabled", false);
            $("#choose-cash").attr("placeholder", '');
          }
          else {
            $("#choose-cash").attr("disabled", true);
            $("#choose-cash").val(payArr[val-1].price);
          }
        })
        /*
          Buggy : set again disabled = true and placeholder again when window is reopened
        */
        /*
          When trying to submit the form, just validate the input value, and check emptyness.
        */
        $("input[name='using-night']").click(function(event) {
          alert($(this).is(':checked'));
        });
        $("#charge-btn").click(function(event) {
          event.preventDefault();
          
          var memberId    = $("#choose-member").val();
          var paymentIdx  = $("#choose-payment").prop('selectedIndex');
          var cash        = $("#choose-cash").val();
          var discount    = $('#choose-discount').val();
          var night       = $('input[name="using-night"]').is(':checked');
          
          if (discount == "") {
            discount=0;
          }
          
          if (paymentIdx === 0) {
            alert("요금제를 선택해주세요.");
            event.preventDefault();
          }
          else if (cash === '') {
            
            alert("금액을 입력해주세요.");
            event.preventDefault();
          }
          else {
            $.ajax({
              url: '/charge',
              method: 'post',
              data: {
                minPerDay   :  payArr[paymentIdx-1].timePerDay,
                member      :  memberId,
                paymentId   :  payArr[paymentIdx-1].id,
                type        :  payArr[paymentIdx-1].type,
                price       :  $('#choose-cash').val(),
                paymentName :  payArr[paymentIdx-1].name,
                discount    :  discount
                //night       : night
              }
            }).done(function(result) {
              if (result == "err0") {
                alert('성공적으로 등록되었습니다.');
              }
              else if (result == "err1") {
                alert('다른 요금제를 사용중입니다. 환불 절차를 먼저 거쳐주세요.');
              }
              else if(result =="err2") {
                alert('존재하지 않는 ID입니다.');
              }
              // clean up
              $("#choose-member").val("");
              $("#choose-payment").prop('selectedIndex', 0);
              $("#choose-cash").val("");
              $('#choose-discount').val("");
              //- $('input[name="using-night"]').attr("checked", false);
              //- $('.switchery')
              //-   .css("box-shadow", "rgb(223, 223, 223) 0px 0px 0px 0px inset")
              //-   .css("border-color", "rgb(223, 223, 223)")
              //-   .css("background-color", "rgb(255, 255, 255)");
              //- $('.switchery > small').css("left", "0px");
            });
          }
        });
        
        //- When User clicked System Manger button
        $('#system_manager').click(function(event) {
          $.ajax({
            url: '/home',
            method: 'post',
            data: {
              accessToken: valAccess,
              refreshToken: valRefresh
            }
          });          
        });
        
        //- When User clicked System Manger button
        $('a#clients_page').click(function(event) {
          var valAccess  = window.localStorage.getItem('accessToken');    
          var valRefresh = window.localStorage.getItem('refreshToken');
          
          $("#to-client-page > input[name='accessToken']").val(valAccess);
          $("#to-client-page > input[name='refreshToken']").val(valRefresh);
          $("form#to-client-page").submit();
        });
        
        //-
        //- Periodically request to server to check whether there is users who almost spend their time
        //-
        setInterval(periodicRequest, 15* 60 * 1000);
        /*
          Periodically check paused members
        */
        setInterval(pauseTableChk, 10 * 60 * 1000);
      });
      /*
        all-members-table finder with name
      */ 
      function all_members_finder() {
        var input, filter, table, tr, td, i;
        input = document.getElementById("all-members-filter");
        filter = input.value.toUpperCase();
        table = document.getElementById("all-members-table");
        tr = table.getElementsByTagName("tr");
        
        /*
          Loop through all table rows, and hide those who don't match the search query
        */
        for (var i = 0; i < tr.length; i++) {
          td = tr[i].getElementsByTagName("td")[1]; // filter with name
          if (td) {
            if(td.innerHTML.toUpperCase().indexOf(filter) > -1) {
              tr[i].style.display = "";
            }
            else {
              tr[i].style.display = "none";
            }
          }
        }
      }
      
      /*
        active-members-table finder with name
      */ 
      function active_members_finder() {
        var input, filter, table, tr, td, i;
        input = document.getElementById("active-members-filter");
        filter = input.value.toUpperCase();
        table = document.getElementById("active-members-table");
        tr = table.getElementsByTagName("tr");
        
        /*
          Loop through all table rows, and hide those who don't match the search query
        */
        for (var i = 0; i < tr.length; i++) {
          td = tr[i].getElementsByTagName("td")[1]; // filter with name
          if (td) {
            if(td.innerHTML.toUpperCase().indexOf(filter) > -1) {
              tr[i].style.display = "";
            }
            else {
              tr[i].style.display = "none";
            }
          }
        }
      }
      
      function pauseTableChk() {
        console.log('pauseTC');
        $.ajax({
          url: '/clients/pausechk',
          method: 'post'
        });
      }
      function periodicRequest() {
        $.ajax({
          url: '/clients/scheduler',
          method: 'post',
          data: {reqeust: '1'}
        }).done(function(results) {
          var json = JSON.parse(results);
          console.log(json);
          
          var alert_member_table_body = document.getElementById('alert-member-table-body');
          while (alert_member_table_body.firstChild) {
            alert_member_table_body.removeChild(alert_member_table_body.firstChild);
          }
          /* 
            If there's no element in the table, just add all of them 
          */
          //- if ($('#alert-member-table-body').children().children('td[data-title="ID"]').length === 0) { 
            for (var i = 0; i < json.length; i++) {
              $('#alert-member-table-body').append(
                '<tr>'+
                ' <td data-title="ID">'+ json[i].alias +'</td>' +
                ' <td data-title="seatNum">'+ json[i].seatnum +'</td>' +
                ' <td data-title="timeLeft">'+ json[i].left +"("+json[i].fee+' 원)</td>' +
                ' <td date-title="delete"><a class="delete-row">[삭제하기]</a></td>' +
                '</tr>'
              );
              $('.delete-row').click(function() {
                $(this).parent().parent('tr').remove();
              });
            }
        });
      }
      
      function sellProduct(name, id) {
        $.ajax({
          url: 'members/sell',
          method: 'post',
          data: {
            membername: name,
            alias: id
          }
        }).done(function(results) {
          
        });
      }
      
      function listMemberUsage(name, id) {
        $.ajax({
          url: 'members/usagelist',
          method: 'post',
          data: {
            membername: name,
            alias: id
          }
        }).done(function(results) {
          
        });
      }
